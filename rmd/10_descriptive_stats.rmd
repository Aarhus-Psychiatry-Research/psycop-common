```{r}
source(here("psycop_r_utils", "import_from_sql.r"))

p_load(ggplot2, ggbeeswarm)
```


```{r}
df_demographics <- get_fct("FOR_kohorte_demografi_inkl_2021") %>% 
  format_sql_import() %>% 
  mutate(foedselsdato = ymd(foedselsdato))
```


# Age at first psych visit

# Age at first diabetes for patients with "true"" positives in cohort time
```{r}
df_age_at_first_diabetes <- df_first_diabetes_processed %>% 
  left_join(df_demographics) %>% 
  mutate(age_at_first_diabetes = time_length(difftime(datotid_first_diabetes, foedselsdato), "years"))
```

```{r}
source(here("psycop_r_utils", "raincloud_plot.r"))

ggplot(df_age_at_first_diabetes %>% mutate(group=1), aes(x = age_at_first_diabetes, y = group)) +
  ggdist::stat_halfeye(
    adjust = .5, 
    width = .6, 
    .width = 0, 
    justification = -.3, 
    point_colour = NA) + 
  geom_boxplot(
    width = .1, 
    outlier.shape = NA
  ) +
  geom_quasirandom(
    size = 1,
    alpha = .3,
    position = position_jitter(
      seed = 1, width = .05
    ),
    groupOnX = FALSE
  ) + 
  coord_cartesian(xlim = c(1.2, NA), clip = "off") +
  scale_x_continuous(breaks = seq(5, 100, by = 5))
```

